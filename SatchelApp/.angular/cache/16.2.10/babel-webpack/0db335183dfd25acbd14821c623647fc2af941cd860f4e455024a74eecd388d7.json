{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nexport let CatalogComponent = class CatalogComponent {\n  constructor(router, productService, favouriteService, userService, route, registrationService, configService) {\n    this.router = router;\n    this.productService = productService;\n    this.favouriteService = favouriteService;\n    this.userService = userService;\n    this.route = route;\n    this.registrationService = registrationService;\n    this.configService = configService;\n    this.products = [];\n    this.favouriteProducts = [];\n    this.filters = {};\n    this.productType = '';\n    this.selectedGender = null;\n    this.genderType = [1, 2, 3];\n    this.priceRangeStep = 0;\n  }\n  ngOnInit() {\n    this.route.params.subscribe(params => {\n      this.productType = params['item'];\n      this.updateProducts();\n    });\n    this.updateFavourites();\n  }\n  isFavourite(product) {\n    return this.favouriteProducts.some(favProduct => favProduct.productId === product.productId);\n  }\n  togglePriceFilter() {\n    if (this.priceRangeStep === 1) {\n      this.filters.isFilterByDecreasePrice = true;\n    }\n    if (this.priceRangeStep === 2) {\n      this.filters.isFilterByDecreasePrice = true;\n    }\n    this.priceRangeStep++;\n    this.priceRangeStep %= 2;\n  }\n  toggleFavourite(product, star) {\n    if (!this.userService.isAuthorized) {\n      this.registrationService.setAuthWindowStatus();\n      return;\n    }\n    const isActive = star.src.includes('activeFavourite');\n    star.src = isActive ? this.configService.PATHS.inactiveStar : this.configService.PATHS.activeStar;\n    const action = isActive ? this.favouriteService.DeleteProductFromFavourites.bind(this.favouriteService) : this.favouriteService.AddFavouriteProduct.bind(this.favouriteService);\n    action(product.productId, this.userService.userId).subscribe(() => this.updateFavourites(), console.log);\n  }\n  updateFavourites() {\n    if (this.userService.isAuthorized) {\n      this.favouriteService.GetFavourites(this.userService.userId).subscribe(products => this.favouriteProducts = products, console.error);\n    }\n  }\n  updateProducts() {\n    if (Object.keys(this.filters).length) {\n      this.productService.getFilteredProducts(this.filters, this.productType).subscribe(products => this.products = products, console.error);\n    } else {\n      this.productService.getAllProducts(this.productType).subscribe(products => this.products = products, console.error);\n    }\n  }\n  toggleGenderFilter(gender) {\n    if (gender === this.selectedGender) {\n      this.selectedGender = 0;\n      delete this.filters.filterByGender;\n    } else {\n      this.selectedGender = gender;\n      this.filters.filterByGender = this.selectedGender;\n    }\n    this.updateProducts();\n  }\n  clearFilters() {\n    this.selectedGender = 0;\n    this.filters = {};\n    this.updateProducts();\n  }\n  goToProduct(id) {\n    this.router.navigate(['catalog/product', id]);\n  }\n  getFormatPrice(price) {\n    return this.configService.getFormattedPrice(price);\n  }\n  getActiveStarPath() {\n    return this.configService.PATHS.activeStar;\n  }\n  getInactiveStarPath() {\n    return this.configService.PATHS.inactiveStar;\n  }\n};\nCatalogComponent = __decorate([Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.css']\n})], CatalogComponent);","map":{"version":3,"names":["Component","CatalogComponent","constructor","router","productService","favouriteService","userService","route","registrationService","configService","products","favouriteProducts","filters","productType","selectedGender","genderType","priceRangeStep","ngOnInit","params","subscribe","updateProducts","updateFavourites","isFavourite","product","some","favProduct","productId","togglePriceFilter","isFilterByDecreasePrice","toggleFavourite","star","isAuthorized","setAuthWindowStatus","isActive","src","includes","PATHS","inactiveStar","activeStar","action","DeleteProductFromFavourites","bind","AddFavouriteProduct","userId","console","log","GetFavourites","error","Object","keys","length","getFilteredProducts","getAllProducts","toggleGenderFilter","gender","filterByGender","clearFilters","goToProduct","id","navigate","getFormatPrice","price","getFormattedPrice","getActiveStarPath","getInactiveStarPath","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\Повелитель\\Documents\\GitHub\\Satchel\\SatchelApp\\src\\app\\shared\\components\\routers\\catalog\\catalog.component.ts"],"sourcesContent":["import { Component, OnInit} from '@angular/core';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { ProductService, Filters } from 'src/app/core/services/product.service';\r\nimport { FavouriteService } from 'src/app/core/services/favourite.service';\r\nimport { UserService } from 'src/app/core/services/user.service';\r\nimport { AuthorizationService } from 'src/app/core/services/authorization.service';\r\nimport { ConfigService } from 'src/app/core/services/config.service';\r\n\r\n// не получилось вынести его в service\r\nexport interface Product{\r\n  productId: number,\r\n  name: string,\r\n  description: string,\r\n  producrCategoryId: number,\r\n  productTypeId: number,\r\n  price: number,\r\n  images: string[],\r\n  sizes: string[]\r\n  brandTypeId: number,\r\n  genderTypeId: number,\r\n  sizeName?: string\r\n}\r\n\r\n@Component({\r\n  selector: 'app-catalog',\r\n  templateUrl: './catalog.component.html',\r\n  styleUrls: ['./catalog.component.css']\r\n})\r\n\r\nexport class CatalogComponent implements OnInit{\r\n\r\n  constructor(private router: Router, \r\n              private productService: ProductService, \r\n              private favouriteService: FavouriteService, \r\n              private userService: UserService, \r\n              private route: ActivatedRoute,\r\n              private registrationService: AuthorizationService,\r\n              private configService: ConfigService) { }\r\n\r\n  products: Product[] = [];\r\n  favouriteProducts: Product[] = [];\r\n  filters: Filters = {};\r\n  productType = '';\r\n  selectedGender: number | null = null;\r\n  genderType = [1, 2 ,3];\r\n  priceRangeStep = 0;\r\n\r\n  ngOnInit() {\r\n    this.route.params.subscribe(params => { \r\n      this.productType = params['item']; \r\n      this.updateProducts();   \r\n    });\r\n    this.updateFavourites();\r\n  }\r\n\r\n  isFavourite(product: Product): boolean {\r\n    return this.favouriteProducts.some(favProduct => favProduct.productId === product.productId);\r\n  }\r\n\r\n  togglePriceFilter() {\r\n  \r\n    if (this.priceRangeStep === 1) {\r\n      this.filters.isFilterByDecreasePrice = true;\r\n    }\r\n\r\n    if (this.priceRangeStep === 2) {\r\n      this.filters.isFilterByDecreasePrice = true;\r\n    }\r\n  \r\n    this.priceRangeStep++;\r\n    this.priceRangeStep %= 2; \r\n  }\r\n\r\n  toggleFavourite(product: Product, star: HTMLImageElement) {\r\n    if(!this.userService.isAuthorized){\r\n      this.registrationService.setAuthWindowStatus();\r\n      return;\r\n    }     \r\n  \r\n    const isActive = star.src.includes('activeFavourite');\r\n    star.src = isActive ? this.configService.PATHS.inactiveStar : this.configService.PATHS.activeStar;\r\n    const action = isActive ? this.favouriteService.DeleteProductFromFavourites.bind(this.favouriteService) : this.favouriteService.AddFavouriteProduct.bind(this.favouriteService);\r\n  \r\n    action(product.productId, this.userService.userId).subscribe(() => this.updateFavourites(), console.log);\r\n  }\r\n\r\n  updateFavourites() {\r\n    if(this.userService.isAuthorized) { \r\n      this.favouriteService.GetFavourites(this.userService.userId).subscribe(\r\n        products => this.favouriteProducts = products,\r\n        console.error\r\n      );\r\n    } \r\n  }\r\n\r\n  updateProducts() {\r\n    if (Object.keys(this.filters).length) {\r\n      this.productService.getFilteredProducts(this.filters, this.productType).subscribe(\r\n        products => this.products = products,\r\n        console.error\r\n      );\r\n    } else {\r\n      this.productService.getAllProducts(this.productType).subscribe(\r\n        products => this.products = products,\r\n        console.error\r\n      );\r\n    }\r\n  }\r\n\r\n  toggleGenderFilter(gender: number) {\r\n    if (gender === this.selectedGender) {\r\n      this.selectedGender = 0;\r\n      delete this.filters.filterByGender;\r\n    } else {\r\n      this.selectedGender = gender;\r\n      this.filters.filterByGender = this.selectedGender;\r\n    }\r\n    this.updateProducts();\r\n  }\r\n\r\n  clearFilters(){\r\n    this.selectedGender = 0;\r\n    this.filters = {};\r\n    this.updateProducts();\r\n  }\r\n\r\n  goToProduct(id: number) {\r\n    this.router.navigate(['catalog/product', id]);\r\n  }\r\n\r\n  getFormatPrice(price: number){\r\n    return (this.configService.getFormattedPrice(price))\r\n  }\r\n\r\n  getActiveStarPath(): string {\r\n    return this.configService.PATHS.activeStar;\r\n  }\r\n  \r\n  getInactiveStarPath(): string {\r\n    return this.configService.PATHS.inactiveStar;\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}